<!DOCTYPE html>
<html lang="en">
<head>
    <title>ç¨‹åºå‘˜å°ç™½èœ</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="ä¸€ä¸ªç¼–ç¨‹å­¦ä¹ ç½‘ç«™">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/themes/vue.css">
    <link rel="stylesheet" href="/assets/css/vue.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <link rel="stylesheet" href="/assets/css/custom.css">
</head>
<body>
<div id="app"></div>
<script>
    window.$docsify = {
        name: 'ç¨‹åºå‘˜å°ç™½èœ',
        repo: 'https://github.com/caijianying/caijianying.github.io',
        auto2top: true,
        coverpage: ['/', '/stress_testing_agent/'],
        loadSidebar: true,
        subMaxLevel: 2,
        <!--é…ç½®å¯¼èˆªæ -->
        loadNavbar: true,
        maxLevel: 4,
        search: {
            paths: 'auto',
            placeholder: 'ğŸ” Type to search ',
            noData: 'ğŸ˜ No Results! ',
            depth: 6
        },
        pagination: {
            previousText: 'PREVIOUS',
            nextText: 'NEXT',
            crossChapter: true
        }
        ,
        plugins: [
            function (hook, vm) {
                hook.doneEach(function () {
                    const label = md5(decodeURIComponent(vm.route.path || '/'));
                    const domObj = Docsify.dom;
                    const main = domObj.getNode("#main");

                    // ç§»é™¤æ—§çš„ Gitalk å®¹å™¨
                    document.querySelectorAll(".gitalk-container").forEach(ele => ele.remove());

                    // åˆ›å»ºæ–°çš„ Gitalk å®¹å™¨
                    const divEle = domObj.create("div");
                    divEle.id = "gitalk-container-" + label;
                    divEle.className = "gitalk-container";
                    divEle.style.width = main ? main.clientWidth + "px" : "100%";
                    divEle.style.margin = "0 auto 20px;";
                    domObj.appendTo(domObj.find(".content"), divEle);

                    // åˆå§‹åŒ– Gitalk
                    if (typeof Gitalk !== "undefined") {
                        const gitalk = new Gitalk(
                            Object.assign(gitalkConfig, {id: label || "home"})
                        );
                        gitalk.render(divEle.id);
                    }

                    // æ›¿æ¢å†…å®¹æ–‡æœ¬
                    const content = document.querySelector(".content");
                    if (content) {
                        Array.from(content.querySelectorAll("p, span,li")).forEach(node => {
                            if (node.innerHTML.includes("highLight(")) {
                                node.innerHTML = node.innerHTML.replace(
                                    /highLight\((.*?)\)/g,
                                    '<strong><span style="color: #ea573f;">$1</span></strong>'
                                );
                            }

                            if (node.innerHTML.includes("collapse(")) {
                                // 2. è§£æ collapse(é—®é¢˜, ç­”æ¡ˆ) è¯­æ³•
                                node.innerHTML = node.innerHTML.replace(
                                    /collapse\(([^,]+),\s*([^)]+)\)/g,
                                    `
                                    <div class="collapse-container">
                                        <div class="collapse-header">$1</div>
                                        <div class="collapse-content">$2</div>
                                    </div>`
                                );
                            }
                        });


                        // 3. æ·»åŠ æŠ˜å /å±•å¼€çš„ç‚¹å‡»äº‹ä»¶
                        document.querySelectorAll('.collapse-header').forEach(header => {
                            header.addEventListener('click', function () {
                                const content = this.nextElementSibling;
                                if (content) {
                                    content.style.display = content.style.display === 'none' ? 'block' : 'none';
                                }
                            });
                        });

                        // 4. åˆå§‹åŒ–é»˜è®¤æŠ˜å çŠ¶æ€
                        document.querySelectorAll('.collapse-content').forEach(content => {
                            content.style.display = 'none'; // é»˜è®¤æŠ˜å ç­”æ¡ˆ
                        });
                    }

                    // Add copy button to pre>code block
                    const codeBlocks = document.querySelectorAll('pre > code');
                    codeBlocks.forEach(codeBlock => {
                        const copyButton = document.createElement('button');
                        copyButton.classList.add('copy-button');
                        copyButton.innerHTML = `
            <svg t="1721703489803" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4313" width="25" height="25">
                <path d="M682.666667 341.333333h128v469.333334H341.333333v-128H213.333333V213.333333h469.333334v128z m0 85.333334v256h-256v42.666666h298.666666v-298.666666h-42.666666zM298.666667 298.666667v298.666666h298.666666V298.666667H298.666667z" fill="#3dc746" p-id="4314"></path>
            </svg>
        `;
                        const successMessage = document.createElement('div');
                        successMessage.classList.add('copy-success');
                        successMessage.innerText = 'å¤åˆ¶æˆåŠŸ!';
                        codeBlock.parentElement.style.position = 'relative'; // Ensure the parent element is positioned
                        codeBlock.parentElement.appendChild(copyButton);
                        codeBlock.parentElement.appendChild(successMessage);

                        copyButton.addEventListener('click', () => {
                            // Create a temporary textarea to copy the text
                            const textarea = document.createElement('textarea');
                            textarea.value = codeBlock.innerText;
                            document.body.appendChild(textarea);
                            textarea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textarea);
                            // Provide feedback to the user
                            successMessage.style.display = 'block';
                            setTimeout(() => {
                                successMessage.style.display = 'none';
                            }, 2000);
                        });
                    });
                    const article = document.querySelector('.markdown-section');
                    let articles = ['Step3: æ•°æ®éš”ç¦»', 'Step4: é“¾è·¯ç›‘æ§', 'Step5: ç†”æ–­é€šçŸ¥'];

                    let needToLock = needLock(articles);
                    let unLocked = hasUnLocked();
                    let mustLock = needToLock && !unLocked;

                    article.style.overflow = null;
                    if (mustLock) {
                        lock();
                        let intervalId = setInterval(() => {
                            checkIsFans(function (token) {
                                const overlay = document.querySelector('.lock-overlay');
                                let readMoreBtn = document.querySelector('#read-more-btn');
                                readMoreBtn.style.display = 'none'; // Hide the read more button
                                let overlayMask = document.querySelector('.overlay-mask');
                                overlayMask.style.display = 'none'; // Hide the overlay mask
                                overlay.style.display = 'none';
                                article.style.maxHeight = 'none';
                                article.style.overflow = 'visible';
                                clearInterval(intervalId)
                                localStorage.setItem(token, 'UNLOCKED');
                            });
                        }, 2000)
                    } else {
                        article.style.maxHeight = 'none';
                        article.style.overflow = 'visible';
                    }
                });

                function hasUnLocked() {
                    let check = localStorage.getItem(getToken());
                    if (check != null) {
                        return check == 'UNLOCKED';
                    }
                    return false;
                }

                function generateVerificationCode() {
                    const charset = '0123456789ABCDEFGHJKLMNPQRSTUVWXYZ';
                    const length = 6;
                    let code = '';

                    for (let i = 0; i < length; i++) {
                        const randomIndex = Math.floor(Math.random() * charset.length);
                        code += charset[randomIndex];
                    }

                    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ç”Ÿæˆçš„éªŒè¯ç 
                    const isValid = /^[0-9A-Za-z]{6}$/.test(code);
                    if (isValid) {
                        return code;
                    } else {
                        // å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œé€’å½’ç”Ÿæˆæ–°çš„éªŒè¯ç 
                        return generateVerificationCode();
                    }
                }

                function lock() {
                    const article = document.querySelector('.markdown-section');
                    const key = 'docsify.lock.key';
                    let verificationCode = localStorage.getItem(key);

                    // Create read more button
                    const readMoreBtn = document.createElement('button');
                    readMoreBtn.id = 'read-more-btn';
                    readMoreBtn.textContent = 'é˜…è¯»å…¨æ–‡';
                    article.appendChild(readMoreBtn);

                    // Create overlay mask
                    const overlayMask = document.createElement('div');
                    overlayMask.classList.add('overlay-mask');
                    article.appendChild(overlayMask);

                    // Create lock overlay
                    const overlay = document.createElement('div');
                    overlay.classList.add('lock-overlay');
                    overlay.innerHTML = `
                        <button class="close-btn">&times;</button>
                        <h2>æ‰«ç æˆ–æœç´¢ï¼š<span class="highlight">ç¨‹åºå‘˜å°ç™½èœ</span></h2>
                        <h2>å‘é€ï¼š<span class="highlight">${verificationCode}</span></h2>
                        <h2>å³å¯<span class="highlight">ç«‹å³æ°¸ä¹…</span>è§£é”æœ¬ç«™æ‰€æœ‰æ–‡ç« </h2>
                        <img src="./assets/home/img/qrCode.jpg" alt="QR Code">
                    `;

                    // Append overlay to body
                    document.body.appendChild(overlay);

                    // Add click event to read more button
                    readMoreBtn.addEventListener('click', function () {
                        const rect = readMoreBtn.getBoundingClientRect();
                        overlay.style.top = `${rect.top - overlay.offsetHeight - 350}px`;
                        overlay.style.left = `${rect.left + rect.width / 2 - overlay.offsetWidth / 2}px`;
                        overlay.style.display = 'block';
                    });

                    const closeBtn = overlay.querySelector('.close-btn');
                    closeBtn.addEventListener('click', function () {
                        overlay.style.display = 'none';
                    });

                    // Adjust article height to show remaining 10% content below the button
                    const adjustArticleHeight = () => {
                        const totalHeight = article.scrollHeight;
                        const visibleHeight = totalHeight * 0.1 + readMoreBtn.offsetHeight;
                        article.style.maxHeight = `${visibleHeight}px`;
                    };

                    // Call the function initially
                    adjustArticleHeight();
                }


                function checkIsFans(func) {
                    let token = getToken();
                    fetch("https://nse4qtqv6ao7-2921.shanghai-01.dayunet.com/api/check?token=" + token)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data && func) {
                                func(token)
                            }
                        })
                        .catch(error => {
                            console.error('There was a problem with your fetch operation:', error);
                            return false
                        });
                }

                function needLock(articles) {
                    if (isActiveSubSidebarLink()){
                        return true
                    }
                    let titleEle = document.querySelector('.sidebar-nav').querySelector('li ul .active a');
                    if (titleEle != null) {
                        const curArticle = titleEle.textContent;
                        for (let article of articles) {
                            if (curArticle == article) {
                                console.log(curArticle + '====' + getSubSidebarLinks())
                                return true
                            }
                        }
                    }
                    return false
                }

                function getSubSidebarLinks() {
                    const links = document.querySelectorAll('.app-sub-sidebar a');
                    return Array.from(links).map(link => link.textContent.trim());
                }

                function isActiveSubSidebarLink() {
                    return !!document.querySelector('.app-sub-sidebar .active');
                }

                function getToken() {
                    const key = 'docsify.lock.key';
                    let id = localStorage.getItem(key);
                    if (id == null) {
                        id = generateVerificationCode();
                        localStorage.setItem(key, id);
                    }
                    return id;
                }
            },
        ]
    }
</script>

<script src="/assets/js/md5.js"></script>
<script src="/assets/js/docsify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.js"></script>
<script src="/assets/js/docsify-pagination.min.js"></script>
<script src="/assets/js/zoom-image.js"></script>
<script src="/assets/js/prism-bash.js"></script>
<script src="/assets/js/prism-java.min.js"></script>
</body>
</html>
